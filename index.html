
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coolify Deploy Pop!</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --c-bg-1: #FF9A9E;
            --c-bg-2: #FECFEF;
            --c-bubble: rgba(255, 255, 255, 0.4);
            --c-accent: #fff;
            --c-text: #594D74;
        }

        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            font-family: 'Nunito', sans-serif;
            touch-action: none; /* Prevent scrolling on mobile */
            user-select: none;
        }

        #game-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; /* Let clicks pass through to canvas when needed */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            color: white;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
            margin: 0;
            pointer-events: auto;
        }

        p {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .btn {
            pointer-events: auto;
            background: white;
            color: #FF6B6B;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-family: 'Fredoka One', cursive;
            border-radius: 50px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-top: 20px;
        }

        .btn:active {
            transform: scale(0.9);
        }

        .progress-bar-container {
            width: 300px;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 20px;
            margin: 20px;
            overflow: hidden;
            display: none; /* Hidden by default */
            border: 2px solid white;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background: #FFD93D;
            transition: width 0.1s linear;
        }

        /* Stage 3 specific UI */
        #mash-btn {
            display: none;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: #FF6B6B;
            color: white;
            font-size: 2rem;
            border: 10px solid white;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(255, 107, 107, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .overlay {
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
            padding: 40px;
            border-radius: 20px;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Success Confetti Logic handled in Canvas, but here is success text */
        .success-text {
            color: #6BCB77;
            display: none;
        }

    </style>
</head>
<body>

    <canvas id="game-layer"></canvas>

    <div id="ui-layer">
        
        <div id="start-screen" class="overlay">
            <h1>Deploy Pop!</h1>
            <p>Test your Coolify Instance</p>
            <button class="btn" onclick="startGame()">Start Test</button>
        </div>

        <div id="hud" style="display:none; position: absolute; top: 20px;">
            <h1 id="stage-title">Stage 1</h1>
            <p id="instruction">Pop 10 Code Bubbles!</p>
            <div class="progress-bar-container" id="progress-container">
                <div class="progress-bar-fill" id="progress-fill"></div>
            </div>
        </div>

        <button id="mash-btn" class="btn" onclick="mash()">DEPLOY!</button>

        <div id="end-screen" class="overlay" style="display:none;">
            <h1 style="color:#FFD93D">SUCCESS!</h1>
            <p>Your Coolify Server is 100% Awesome.</p>
            <button class="btn" onclick="location.reload()">Re-Deploy</button>
        </div>

    </div>

    <script>
        const canvas = document.getElementById('game-layer');
        const ctx = canvas.getContext('2d');
        
        // Game State
        let stage = 0; // 0=Menu, 1=Pop, 2=Dodge, 3=Mash, 4=Win
        let score = 0;
        let particles = [];
        let bubbles = [];
        let enemies = [];
        let mouse = { x: 0, y: 0 };
        let width, height;

        // Resize handling
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Mouse/Touch tracking
        window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
        window.addEventListener('touchmove', e => { 
            mouse.x = e.touches[0].clientX; 
            mouse.y = e.touches[0].clientY; 
        });

        window.addEventListener('mousedown', handleInput);
        window.addEventListener('touchstart', (e) => {
            mouse.x = e.touches[0].clientX; 
            mouse.y = e.touches[0].clientY;
            handleInput();
        });

        // --- CLASSES ---

        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.radius = Math.random() * 5 + 2;
                this.speedX = (Math.random() - 0.5) * 10;
                this.speedY = (Math.random() - 0.5) * 10;
                this.life = 1.0;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= 0.02;
                this.radius *= 0.95;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.life;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }

        class Bubble {
            constructor(type) {
                this.radius = Math.random() * 30 + 20;
                this.x = Math.random() * (width - this.radius * 2) + this.radius;
                this.y = height + this.radius;
                this.speed = Math.random() * 3 + 1;
                this.type = type; // 'code' (good), 'bug' (bad)
                this.wobble = Math.random() * Math.PI * 2;
                
                if (type === 'code') this.color = '#4ECDC4'; // Teal
                else if (type === 'bug') this.color = '#FF6B6B'; // Red
                else if (type === 'test') this.color = '#FFE66D'; // Yellow
            }
            update() {
                this.y -= this.speed;
                this.x += Math.sin(this.wobble) * 1;
                this.wobble += 0.05;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.lineWidth = 3;
                ctx.strokeStyle = 'white';
                ctx.stroke();
                
                // Shine
                ctx.beginPath();
                ctx.arc(this.x - this.radius/3, this.y - this.radius/3, this.radius/4, 0, Math.PI*2);
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.fill();
            }
        }

        // --- GAME LOGIC ---

        function spawnExplosion(x, y, color) {
            for(let i=0; i<15; i++) {
                particles.push(new Particle(x, y, color));
            }
        }

        function handleInput() {
            if (stage === 1) {
                // Check clicks on bubbles
                for (let i = bubbles.length - 1; i >= 0; i--) {
                    let b = bubbles[i];
                    let dist = Math.hypot(b.x - mouse.x, b.y - mouse.y);
                    if (dist < b.radius + 20) { // +20 for forgiving touch
                        spawnExplosion(b.x, b.y, b.color);
                        bubbles.splice(i, 1);
                        score++;
                        updateProgress(score, 10);
                        if (score >= 10) startStage2();
                        break;
                    }
                }
            }
        }

        function updateProgress(current, max) {
            const pct = (current / max) * 100;
            document.getElementById('progress-fill').style.width = `${pct}%`;
        }

        // STAGE MANAGEMENT

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('hud').style.display = 'block';
            document.getElementById('progress-container').style.display = 'block';
            startStage1();
        }

        function startStage1() {
            stage = 1;
            score = 0;
            document.getElementById('stage-title').innerText = "Stage 1: The Build";
            document.getElementById('instruction').innerText = "Tap 10 Code Bubbles to Compile!";
            document.body.style.background = "linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)";
        }

        function startStage2() {
            stage = 2;
            score = 0;
            updateProgress(0, 100);
            bubbles = [];
            document.getElementById('stage-title').innerText = "Stage 2: The Test";
            document.getElementById('instruction').innerText = "Hover to collect Yellow Tests, Avoid Red Bugs!";
            document.body.style.background = "linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)";
        }

        let stage3MashCount = 0;
        function startStage3() {
            stage = 3;
            bubbles = [];
            document.getElementById('stage-title').innerText = "Stage 3: Production";
            document.getElementById('instruction').innerText = "MASH THE BUTTON TO DEPLOY!";
            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('mash-btn').style.display = 'block';
            document.body.style.background = "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)";
            updateProgress(0, 20);
        }

        function mash() {
            if (stage !== 3) return;
            stage3MashCount++;
            spawnExplosion(window.innerWidth/2, window.innerHeight/2, '#fff');
            updateProgress(stage3MashCount, 20);
            
            // Random shake effect
            const btn = document.getElementById('mash-btn');
            btn.style.transform = `scale(0.95) rotate(${Math.random()*10 - 5}deg)`;
            setTimeout(() => btn.style.transform = 'scale(1)', 50);

            if (stage3MashCount >= 20) winGame();
        }

        function winGame() {
            stage = 4;
            document.getElementById('hud').style.display = 'none';
            document.getElementById('mash-btn').style.display = 'none';
            document.getElementById('end-screen').style.display = 'block';
            // Infinite confetti
            setInterval(() => {
                spawnExplosion(Math.random()*width, Math.random()*height, `hsl(${Math.random()*360}, 100%, 50%)`);
            }, 100);
        }

        // MAIN LOOP
        function animate() {
            ctx.clearRect(0, 0, width, height);

            // Logic per stage
            if (stage === 1) {
                if (Math.random() < 0.05) bubbles.push(new Bubble('code'));
            } else if (stage === 2) {
                if (Math.random() < 0.03) bubbles.push(new Bubble('bug'));
                if (Math.random() < 0.03) bubbles.push(new Bubble('test'));
                
                // Auto-progress bar for survival time
                score += 0.2;
                updateProgress(score, 100);
                if(score >= 100) startStage3();

                // Collision Logic (Mouse vs Bubble)
                for (let i = bubbles.length - 1; i >= 0; i--) {
                    let b = bubbles[i];
                    let dist = Math.hypot(b.x - mouse.x, b.y - mouse.y);
                    
                    if (dist < b.radius + 10) {
                        if (b.type === 'bug') {
                            score -= 10; // Penalty
                            spawnExplosion(b.x, b.y, 'red');
                            document.body.style.filter = "invert(1)"; // Glitch effect
                            setTimeout(() => document.body.style.filter = "none", 100);
                        } else {
                            score += 5; // Bonus
                            spawnExplosion(b.x, b.y, 'yellow');
                        }
                        bubbles.splice(i, 1);
                    }
                }
            }

            // Draw Bubbles
            for (let i = bubbles.length - 1; i >= 0; i--) {
                let b = bubbles[i];
                b.update();
                b.draw();
                if (b.y < -50) bubbles.splice(i, 1);
            }

            // Draw Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].life <= 0) particles.splice(i, 1);
            }

            requestAnimationFrame(animate);
        }

        animate();

    </script>
</body>
</html>
